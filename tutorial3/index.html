
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
        <head>
                <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
                <title>web.py 0.3 tutorial (web.py)</title>
                <link rel="stylesheet" type="text/css" href="/static/webpy-new.css"/>
                <link rel="SHORTCUT ICON" href="/static/favicon.ico"/>
        </head>
<body>

        <div id="header">
                <span class="logo"><a href="/" title="Home"><img src="/static/webpy.gif" alt="" /></a></span>
                <span class="blurb">&quot;Think about the ideal way to write a web app.<br />Write the code to make it happen.&quot; <a href="http://groups.google.com/group/webpy/msg/f266701d97e7ceb1">(More...)</a></span>
        </div>

        <div id="location">
                <a href="/">home</a> &gt; web.py 0.3 tutorial
        </div>

<div id="container">
        <div id="sidebar">
                  <strong>Get It:</strong><br />
                  &nbsp;<a href="/download">download</a><br />
                  &nbsp;<a href="/changes">change log</a><br />
                  <br />
                  
                  <strong>Learn It:</strong><br />
                  &nbsp;<a href="/install">install</a><br />
                  &nbsp;<a href="/tutorial3.en">tutorial</a><br />

                  &nbsp;<a href="/faq">faq</a><br />
                  &nbsp;<a href="/docs/0.3">docs</a><br />
                  &nbsp;<a href="/recommended_setup">setup</a><br />
          &nbsp;<a href="/cookbook">cookbook</a><br/>
                  <br />
                  
                  <strong>Discuss It:</strong><br />
                  &nbsp;<a href="http://groups.google.com/group/webpy/">mailing list</a><br />
                  &nbsp;<a href="irc://irc.freenode.net/webpy">irc</a><br />
                  <br />
        
                  <strong>Follow It:</strong><br />
                  &nbsp;<a href="http://github.com/webpy/webpy">code</a><br />
          &nbsp;<a href="http://launchpad.net/webpy">launchpad</a><br />
</div>

<div id="main">
<div id="content">


<h1>web.py 0.3 tutorial</h1>
<p>This is a work-in-progress
</p>

<h2>TODO: app.internalerror = web.debugerror</h2>

<h2>TODO: '$user' vs. '$:user' and '$var user:$user' vs. '$var user:$user'</h2>

<h2>TODO: Multiple submit buttons</h2>

<h2>TODO: Show/hide complete code at the end of sections</h2>
<p>TODO: move the next paragraph over to install?
</p>
<p>To create a website with web.py you need to know the Python programming language and have it installed. Installation instructions for Python can be found at <a href="http://python.org/">http://python.org/</a> .If you don't know if Python is installed on your system, open a terminal and type <code>python</code>. A great starting point to learn Python is the official <a href="http://docs.python.org/tut/tut.html">tutorial</a>. If you are new to programming in general, <a href="http://www.greenteapress.com/thinkpython/">Think Python</a> is a wonderful book to understand key concepts in programming. 
</p>

<h2>TOC</h2>
<p>TODO: ...
</p>

<h2>Prerequisites</h2>
<p>This tutorial assumes that both Python and web.py are installed on your system. If this is not the case, please follow the <a href="http://webpy.org/install">installation instructions</a> before you continue.
</p>
<p>Furthermore, basic HTML knowledge is needed to understand some examples.
</p>

<h2>Hello Web in web.py</h2>
<p>Open your favorite text editor and create a new file <code>hello.py</code>. In this file you will define the content and logic of your web application as well as its web addresses (URLs).
</p>
<p>Before you are able to use the tools web.py provides, you need to import the web.py module with the following code:
</p>
<pre><code>import web
</code></pre><p>In web.py web pages are mapped to Python classes. Let's create the code for the first page which is here called <code>hello</code>:
</p>
<pre><code>class hello:
    def GET(self):
        return &quot;Hello, Web!&quot;
</code></pre><p>The <code>hello</code> class has a function named <code>GET</code> which returns &quot;Hello, Web!&quot;. Why <code>GET</code>?
</p>
<p>When you open a web page, your browser asks for the content of that page. This request is called the <code>GET</code> method. web.py uses the same terminology. The string your <code>GET</code> method returns is displayed in your browser.
</p>
<p>Although the code for your first page is written, it cannot yet be opened in a browser. Let's proceed with mapping a web address (URL) to your class. Insert the following code after the import statement:
</p>
<pre><code>urls = (
  '/', 'hello')
</code></pre><p>This tells web.py to map the root of your website (like http://webpy.org/) to your Python class named <code>hello</code>.
</p>
<p>Next create an instance of a web.py application. This instance will be the mediator between your classes and the web. It will handle browser requests and serve your pages. (In short: It will do everything that you really don't want to care about.) Use the following code:
</p>
<pre><code>app = web.application(urls, globals())
</code></pre><p>Note that <code>web.application()</code> gets called with two arguments. Your URL mapping (<code>urls</code>) and your global namespace which contains your <code>hello</code> class (<code>globals()</code>).
</p>
<p>To finish your web.py application insert the following code at the end of your code:
</p>
<pre><code>if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre><p><code>app.run()</code> starts the web application to serve requested pages.
</p>

<h3>Complete code</h3>
<p>hello.py
</p>
<pre><code>import web

urls = (
  '/', 'hello')

app = web.application(urls, globals())

class hello:
    def GET(self):
        return 'Hello, web!'

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre><p>Save the file and run the following command to start your application:
</p>
<pre><code>python hello.py
</code></pre><p>The first output of your application is the address of your web site. By default this is:
</p>
<pre><code>http://locahost:8080/
</code></pre><p>Open this address with your web browser. That's it. Congrats! You can stop your application at any time by pressing <code>ctrl+c</code> in the terminal.
</p>
<p>Note: You can also visit your site at <code>http://localhost:8080/</code>
</p>

<h2>Having multiple pages</h2>
<p>In this part you will learn how to manage multiple pages. Let's add another class to your 'Hello Web' application:
</p>
<pre><code>class bye:
    def GET(self):
        return 'Bye, web!'
</code></pre><p>As mentioned above, each page needs a unique address. Modify your list of URLs as follows:
</p>
<pre><code>urls = (
  '/', 'hello',
  '/bye', 'bye')
</code></pre><p>This will make your class <code>bye</code> respond to requests at <code>/bye/</code>. Now start your application and open <code>http://localhost:8080/bye/</code> in your browser.
</p>
<p>Note: Currently you need to restart your application to see any changes. Try to pass a third argument to <code>web.application</code> and restart your application:
</p>
<pre><code>app = web.application(urls, globals(), True)
</code></pre><p>Future changes can now be seen instantly, although you might need to reload a page in your browser.
</p>

<h3>Complete code</h3>
<p>hello.py
</p>
<pre><code>import web

urls = (
  '/', 'hello',
  '/bye', 'bye')

app = web.application(urls, globals(), True)

class hello:
    def GET(self):
        return 'Hello, web!'

class bye:
    def GET(self):
        return 'Bye, web!'

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre>
<h2>Dynamic pages</h2>
<p>The examples shown above are simple; all it does it display the same message, every time.  Suppose you want your app to greet people by name?
</p>

<h3>A dynamic &quot;Hello, world!&quot; -- using GET and POST variables</h3>
<p>Change the &quot;hello&quot; class above so it looks like this:
</p>
<pre><code>class hello:
    def GET(self):
        i = web.input(name = 'web')
        return 'Hello, ' + web.websafe(i.name) + '!'
</code></pre><p>Run the script, and then go to http://localhost:8080/?name=Luke .  You should see &quot;Hello, Luke!.&quot;
</p>
<p>Here is what is happening:
</p>
<p>When you add the &quot;?name=Luke&quot; to the end of your web request, you are passing the variable &quot;name&quot; to the web server, with a value of &quot;Luke.&quot;
</p>
<p>The line <code>i = web.input(name = &quot;web&quot;)</code> creates a Storage object (a fancy type of Python dictionary) that contains all variables passed into it.  You can also do this by just calling <code>i = web.input()</code>.  Here, by putting <code>name = 'web'</code> into the call, we tell it to use the string &quot;web&quot; as a default, in case the user didn't pass in a &quot;name&quot; variable at all.
</p>
<p>We read the &quot;name&quot; value from i by just saying <code>i.name</code>.  It's also possible to do <code>i['name']</code>; use the syntax you prefer.
</p>
<p>Finally, we pass i.name through the <code>web.websafe</code> function before returning it to the user.  If your page is being served as HTML, rather than text, then this is an important security step to protect against <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting attacks</a>.  (As we will see, web.py's form templates offer built-in protection to those attacks).
</p>

<h3>Another dynamic &quot;Hello, world!&quot; -- parsing URL strings</h3>
<p>Making the user type in something like &quot;http://localhost:8080/?name=Luke&quot; is so 1996; wouldn't it be nicer if we could just get the user to enter &quot;http://localhost:8080/Luke&quot;?
</p>
<p>Try this code:
</p>
<pre><code>import web

urls = (
  '/(.*)', 'hello')

app = web.application(urls, globals())

class hello:
    def GET(self, name):
        return 'Hello, ' + web.websafe(name) + '!'

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre><p>Notice that two things have changed:
</p>
<ol>
 <li>
     The urls has a &quot;(.*)&quot; thing in it
 </li>

 <li>
     The <code>GET</code> method now takes two parameters
 </li>

 <li>
     There's no more <code>web.input</code> call.
 </li>
</ol>
<p>As you can see, web.py is parsing the URL for you, based on a <a href="http://docs.python.org/lib/re-syntax.html">regular expression</a> that you provide in the <code>urls</code> tuple.
</p>

<h2>HTML in Python</h2>
<p>Until now your classes returned only simple strings. Let's add some HTML. This can be done directly from inside your <code>hello.py</code>. Replace your class <code>hello</code> with this code:
</p>
<pre><code>class hello:
    def GET(self):
        return &quot;&quot;&quot;&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Hello, web!&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;web.py&lt;/h1&gt;
&lt;p&gt;Think about the &lt;em&gt;ideal&lt;/em&gt; way to write a web app. Write the code to &lt;b&gt;make it happen&lt;/b&gt;.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;&quot;&quot;
</code></pre><p>Note that your page now has a custom title and HTML formatted content.
</p>

<h3>Complete code</h3>
<p>hello.py
</p>
<pre><code>import web

urls = (
  '/', 'hello',
  '/bye', 'bye')

app = web.application(urls, globals(), True)

class hello:
    def GET(self):
        return &quot;&quot;&quot;&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Hello, web!&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;web.py&lt;/h1&gt;
&lt;p&gt;Think about the &lt;em&gt;ideal&lt;/em&gt; way to write a web app. Write the code to &lt;b&gt;make it happen&lt;/b&gt;.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;&quot;&quot;

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre>
<h2>HTML with site layout templates</h2>
<p>Imagine a larger site with many pages. If all HTML for these pages is embedded into your Python code, things get messy and your code unmaintainable. Also reusing parts of your HTML code for other pages would be difficult. Therefore web.py lets you define site layout templates that can be shared between your pages.
</p>
<p>First create a directory <code>templates</code> next to your <code>hello.py</code> file. Create a file <code>hello.html</code> and save it in <code>templates</code>. This file will contain the HTML markup that is used to render your page. Start with the following basic template:
</p>
<pre><code>$def with (title, name, content)
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;$title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;You are visiting page &lt;b&gt;$name&lt;/b&gt;.&lt;/p&gt;
&lt;p&gt;$content&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Create a second template <code>bye.html</code>:
</p>
<pre><code>$def with (title, name, *numbers)
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;$title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;You are visiting page &lt;b&gt;$name&lt;/b&gt;.&lt;/p&gt;
&lt;p&gt;Find the answer to all questions below:
$for number in numbers:
    &lt;p&gt;$number&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Besides defining a page structure, these templates will use variables. The first line of <code>hello.html</code> (<code>def with (title, name, number)</code>) will tell web.py that this template needs to be called with three arguments. Wherever <code>$title</code> is used in the template the actual value of <code>title</code> is inserted.
</p>
<p>Arguments of <code>bye.html</code> are <code>title</code>, <code>name</code> and an arbitrary number of numbers (<code>*numbers</code>). All arguments beside <code>title</code> and <code>name</code> are put into the list <code>numbers</code>. This list is then iterated (<code>$for number in numbers:</code>) and each number (<code>number</code>) is written in its own paragraph. You see that <code>$</code> is not only used to access template variables but also to evaluate (safe) Python code like <code>for</code> loops or <code>if</code> statements.
</p>
<p>Now insert the following line before your class definitions to create a so called template renderer. The location of your templates is passed to the renderer as an argument:
</p>
<pre><code>render = web.template.render('templates/')
</code></pre><p>Next modify your classes to render your pages using the two different templates:
</p>
<pre><code>class hello:
    def GET(self):
        return render.hello(&quot;Templates demo&quot;, &quot;Hello&quot;, &quot;A long time ago...&quot;)

class bye:
    def GET(self):
        return render.bye(&quot;Templates demo&quot;, &quot;Bye&quot;, &quot;14&quot;, &quot;8&quot;, &quot;25&quot;, &quot;42&quot;, &quot;19&quot;)
</code></pre><p>Open the pages in your browser. web.py fetches your templates and dynamically inserts the values that you passed to your templates.
</p>

<h3>Complete code</h3>
<p>hello.py
</p>
<pre><code>import web

urls = (
  '/', 'hello',
  '/bye/', 'bye')

app = web.application(urls, globals(), True)

render = web.template.render('templates/')

class hello:
    def GET(self):
        return render.hello(&quot;Templates demo&quot;, &quot;Hello&quot;, &quot;A long time ago...&quot;)

class bye:
    def GET(self):
        return render.bye(&quot;Templates demo&quot;, &quot;Bye&quot;, &quot;14&quot;, &quot;8&quot;, &quot;25&quot;, &quot;42&quot;, &quot;19&quot;)

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre><p>templates/hello.html
</p>
<pre><code>$def with (title, name, content)
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;$title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;You are visiting page &lt;b&gt;$name&lt;/b&gt;.&lt;/p&gt;
&lt;p&gt;$content&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>templates/bye.html
</p>
<pre><code>$def with (title, name, *numbers)
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;$title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;You are visiting page &lt;b&gt;$name&lt;/b&gt;.&lt;/p&gt;
&lt;p&gt;Find the answer to all questions below:
$for number in numbers:
    &lt;p&gt;$number&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2>Using a base layout (template inheritance)</h2>
<p>The previous example defined two templates but both had duplicate code. In most cases your pages share a lot of common code like a navigation bar or a footer. Let's create a file <code>base.html</code> which contains all the code your pages share with each other:
</p>
<pre><code>$def with (page)
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;$page.title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;You are visiting page &lt;b&gt;$page.name&lt;/b&gt;.&lt;/p&gt;
$:page
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>This base template receives only one variable <code>page</code>. <code>$page.title</code> is a placeholder for a variable named <code>title</code> defined in a child template. <code>$:page</code> is a placeholder for everything else that you put in your child template. Modify <code>hello.html</code> to be a child template:
</p>
<pre><code>$def with (title, name, content)
$var title:$title
$var name:$name
&lt;p&gt;$content&lt;/p&gt;
</code></pre><p>The previously duplicated code for the HTML body, the page title and the current page information is gone. Instead <code>$var title:$title</code> tells the base template to use the local <code>title</code> as <code>$page.title</code>. The remaining line <code>&lt;p&gt;$content&lt;/p&gt;</code> will be available in the base template as <code>$:page</code>.
</p>
<p>Modify <code>bye.html</code> accordingly:
</p>
<pre><code>$def with (title, name, *numbers)
$var title:$title
$var name:$name
&lt;p&gt;Find the answer to all questions below:&lt;/p&gt;
$for number in numbers:
    &lt;p&gt;$number&lt;/p&gt;
</code></pre><p>The last step is to tell web.py to use <code>base.html</code> as the base template. Use the following code (you might need to replace your previous code):
</p>
<pre><code>render = web.template.render('templates/', base='base')
</code></pre><p>Both <code>hello.html</code> and <code>bye.html</code> will now use <code>base.html</code>.
</p>

<h3>Complete code</h3>
<p>hello.py
</p>
<pre><code>import web

urls = (
  '/', 'hello',
  '/bye/', 'bye')

app = web.application(urls, globals(), autoreload=True)

render = web.template.render('templates/', base='base')

class hello:
    def GET(self):
        return render.hello(&quot;Templates demo&quot;, &quot;Hello&quot;, &quot;A long time ago...&quot;)

class bye:
    def GET(self):
        return render.bye(&quot;Templates demo&quot;, &quot;Bye&quot;, &quot;14&quot;, &quot;8&quot;, &quot;25&quot;, &quot;42&quot;, &quot;19&quot;)

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre><p>base.html
</p>
<pre><code>$def with (page)
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;$page.title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;You are visiting page &lt;b&gt;$page.name&lt;/b&gt;.&lt;/p&gt;
$:page
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>hello.html
</p>
<pre><code>$def with (title, name, content)
$var title:$title
$var name:$name
&lt;p&gt;$content&lt;/p&gt;
</code></pre><p>bye.html
</p>
<pre><code>$def with (title, name, *numbers)
$var title:$title
$var name:$name
&lt;p&gt;Find the answer to all questions below:&lt;/p&gt;
$for number in numbers:
    &lt;p&gt;$number&lt;/p&gt;
</code></pre>
<h2>Static content</h2>
<p>Now that your application serves HTML formatted content, you probably want to include static files like images or css style files. To achieve this create a directeory called <code>static</code> next to your <code>hello.py</code> file. Put a picture file (here called <code>logo.png</code>) in your <code>static</code> directory. Then include the file on your page:
</p>
<pre><code>class hello:
    def GET(self):
        return &quot;&quot;&quot;&lt;img src=&quot;./static/logo.png&quot;&gt;&quot;&quot;&quot;
</code></pre>
<h3>Complete code</h3>
<p>hello.py
</p>
<pre><code>import web

urls = (
  '/', 'hello')

app = web.application(urls, globals(), web.reloader)

class hello:
    def GET(self):
        return &quot;&quot;&quot;&lt;img src=&quot;./static/logo.png&quot;&gt;&quot;&quot;&quot;

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre>
<h2>User input (HTML forms and the <code>POST</code> method) <a href="http://webpy.org/form">cookbook</a></h2>
<p>Until now <code>GET</code> functions were introduced to serve pages but there was no way a user could send data back to your application. A function called <code>POST</code> will allow this. To use <code>POST</code> you need to create form fields on your page where a user can input his data. Let's make <code>hello.py</code> return a page that contains HTML forms using web.py <code>form</code> module. To reduce typing add the following import statement:
</p>
<pre><code>from web import form
</code></pre><p>Now define a form before your classes in <code>hello.py</code>. This example only uses a single input field. Visit the <a href="http://webpy.org/form">cookbook</a> for more advanced types. The following code gives you a text box with validation of the input:
</p>
<pre><code>number_form = form.Form( 
    form.Textbox('number',
                 form.notnull,
                 form.regexp('^-?\d+$', 'Not a number.'),
                 form.Validator('Not greater than 10.', lambda x: int(x)&gt;10),
                 description='Enter a number greater than 10:'
                 ))
</code></pre><p><code>form.Textbox()</code> creates an HTML text box. The first parameter specifies its name: <code>'number'</code>.  Most often you will want to validate the input of a user instantly and allow him to correct errors. <code>form.notnull</code> makes it a required field that cannot be left empty. <code>form.regexp()</code> matches the input with the given regular expression. Here it is checked if the input is a number. <code>form.Validator()</code> additionally checks if the input is a number greater ten. And finally, <code>description</code> is the text that is printed in front of the text box.
</p>
<p>Now make your template <code>hello.html</code> accept and display a form:
</p>
<pre><code>$def with (form)
&lt;form name=&quot;test&quot; method=&quot;POST&quot;&gt; 
$if not form.valid: &lt;p&gt;Sorry, your input was invalid.&lt;/p&gt;
$:form.render()
&lt;input type=&quot;submit&quot; value=&quot;Check&quot; /&gt;
&lt;/form&gt;
</code></pre><p>Notice that the template will print an error message if the form input is invalid.
</p>
<p>And finally your <code>hello</code> class needs the following <code>GET</code> and <code>POST</code> methods:
</p>
<pre><code>class hello:
    def GET(self):
        my_form = number_form()
        return render.hello(my_form)

    def POST(self): 
        my_form = number_form() 
        if not my_form.validates(): 
            return render.hello(my_form)
        else:
            number = my_form['number'].value
            if int(number) % 2:
                return &quot;Your number %s is odd.&quot; % number
            else:
                return &quot;Your number %s is even.&quot; % number
</code></pre><p>When you visit <code>hello</code> in your browser, the <code>GET</code> method creates an instance of your form and returns the rendered page. Enter a number greater 10 and press the <code>Check</code> button. Now the <code>POST</code> method is invoked to process your input. Because the <code>GET</code> and <code>POST</code> methods cannot access the same form instance a new one is created. <code>form.validates()</code> checks the input you entered. But how does it know what you have entered? By default the <code>validates()</code> method fetches your input from <code>web.input()</code> where it is stored as soon as you press the <code>Check</code> button. In case your input is invalid, the form is returned again. Else <code>my_form['number'].value</code> is retrieved which is the number you entered and your application will tell you if you entered an even or odd number.
</p>
<p>Note: You cannot access form values before having validated the form!
</p>
<p>Now go back and try some invalid input. First leave the text field blank and press <code>Check</code>. You will be informed that you left a required field blank. Enter some text and you will get a &quot;Not a number&quot; message. This is due to the regular expression check. And finally try some number that is not greater than ten. The form input will not be validated and you are advised to enter a number greater ten.
</p>

<h3>Complete code</h3>
<p>hello.py 
</p>
<pre><code>import web
from web import form

urls = (
  '/', 'hello')

app = web.application(urls, globals(), web.reloader)
render = web.template.render('templates/')

number_form = form.Form( 
    form.Textbox('number',
                 form.notnull,
                 form.regexp('^-?\d+$', 'Not a number.'),
                 form.Validator('Not greater 10.', lambda x: int(x)&gt;10),
                 description='Enter a number greater 10:'
                 ))

class hello:
    def GET(self):
        my_form = number_form()
        return render.hello(my_form)

    def POST(self): 
        my_form = number_form() 
        if not my_form.validates(): 
            return render.hello(my_form)
        else:
            number = my_form['number'].value
            if int(number) % 2:
                return &quot;Your number %s is odd.&quot; % number
            else:
                return &quot;Your number %s is even.&quot; % number

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre><p>hello.html
</p>
<pre><code>$def with (form)
&lt;form name=&quot;test&quot; method=&quot;POST&quot;&gt; 
$if not form.valid: &lt;p&gt;Sorry, your input was invalid.&lt;/p&gt;
$:form.render()
&lt;input type=&quot;submit&quot; value=&quot;Check&quot; /&gt;
&lt;/form&gt;
</code></pre>
<h2>Sessions <a href="http://webpy.org/cookbook/sessions">cookbook</a></h2>
<p>ATTENTION: Sessions cannot be used with <code>web.reloader</code> at the time of this writing! It is a known bug.
</p>
<p>Many sites need to distinguish its visitors. Imagine you want to show the user the number of pages he visited on your page. Each visitor has a unique number. To allow separate tracking web.py uses so called sessions. Each visitor gets his very own session object in which his unique number is saved. First create a session object in <code>hello.py</code>. Put this line after your <code>app</code> is initialized:
</p>
<pre><code>session = web.session.Session(app, web.session.DiskStore('sessions'), initializer={'count': 0})
</code></pre><p>This creates a session object. The first parameter is simply the application the session object is used for. <code>web.session.DiskStore('sessions')</code> tells web.py to store sessions on disk (database storage is possible as well, see this <a href="http://webpy.org/cookbook/sessions">cookbook</a> entry). The third optional parameter initializes the session data dictionary for each user. Here each session object starts with zero visited pages (<code>count</code>). web.py creates a directory <code>sessions</code> to store session data on disk. Modify your classes in <code>hello.py</code> like this:
</p>
<pre><code>class hello:
    def GET(self):
        session.count += 1
        return &quot;You visited &quot; + str(session.count) + &quot; pages.&quot;

class bye:
    def GET(self):
        session.kill()
        return (&quot;Bye, web!&quot;)
</code></pre><p>Each time you visit <code>hello</code>, the number of pages you visited is incremented (<code>session.count += 1</code>). If you visit <code>bye</code> the session is killed (<code>session.kill()</code>). The next time you visit <code>hello</code>, a new session will be created and the counter will be zero again.
</p>

<h3>Complete code</h3>
<p>hello.py
</p>
<pre><code>import web
web.config.debug=False

urls = (
  '/', 'hello',
  '/bye/', 'bye')


app = web.application(urls, globals())
session = web.session.Session(app, web.session.DiskStore('sessions'),
                              initializer={'count': 0})

class hello:
    def GET(self):
        session.count += 1
        return &quot;You visited &quot; + str(session.count) + &quot; pages.&quot;

class bye:
    def GET(self):
        session.kill()
        return (&quot;Bye, web!&quot;)

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre>
<h2>User authentication</h2>
<p>This is an example of user authentication using a session cookie, the most common method.  Most often user authentication is done by providing functions to login and logout a user. Additionally, users often are able to register or delete their account.
</p>

<h3>Complete code</h3>
<p>hello.py
</p>
<pre><code>import web
from web import form

import random
from hashlib import sha1

# A simple user object that doesn't store passwords in plain text
# see http://en.wikipedia.org/wiki/Salt_(cryptography)
class PasswordHash(object):
    def __init__(self, password_):
        self.salt = &quot;&quot;.join(chr(random.randint(33,127)) for x in xrange(64))
        self.saltedpw = sha1(password_ + self.salt).hexdigest()
    def check_password(self, password_):
        &quot;&quot;&quot;checks if the password is correct&quot;&quot;&quot;
        return self.saltedpw == sha1(password_ + self.salt).hexdigest()

# Note: a secure application would never store passwords in plaintext in the source code
users = {
    'Kermit' : PasswordHash('frog'), 
    'ET' : PasswordHash('eetee'),  
    'falken' : PasswordHash('joshua') } 


urls = ('/', 'hello',
        '/logout/', 'logout',
        '/register/', 'register')

app = web.application(urls, globals())
render = web.template.render('templates/')

if web.config.get('_session') is None:
    session = web.session.Session(app, web.session.DiskStore('sessions'),
                              initializer={'user': 'anonymous'})
    web.config._session = session
else:
    session = web.config._session

signin_form = form.Form(form.Textbox('username',
                                     form.Validator('Unknown username.',
                                                    lambda x: x in users.keys()),
                                     description='Username:'),
                        form.Password('password',
                                      description='Password:'),
                        validators = [form.Validator(&quot;Username and password didn't match.&quot;,
                                      lambda x: users[x.username].check_password(x.password)) ])

signup_form = form.Form(form.Textbox('username',
                                     form.Validator('Username already exists.',
                                                    lambda x: x not in users.keys()),
                                     description='Username:'),
                        form.Password('password',
                                      description='Password:'),
                        form.Password('password_again',
                                      description='Repeat your password:'),
                        validators = [form.Validator(&quot;Passwords didn't match.&quot;,
                                      lambda i: i.password == i.password_again)])


class hello:
    def GET(self):
        my_signin = signin_form()
        return render.hello(session.user, my_signin)

    def POST(self): 
        my_signin = signin_form() 
        if not my_signin.validates(): 
            return render.hello(session.user, my_signin)
        else:
            session.user = my_signin['username'].value
            return render.hello(session.user, my_signin)


class logout:
    def GET(self):
        session.kill()
        raise web.seeother('/')


class register:
    def GET(self):
        my_signup = signup_form()
        return render.signup(my_signup)

    def POST(self):
        my_signup = signup_form()
        if not my_signup.validates(): 
            return render.signup(my_signup)
        else:
            username = my_signup['username'].value
            password = my_signup['password'].value
            users[username] = PasswordHash(password)
            raise web.seeother('/')

if __name__ == &quot;__main__&quot;:
    app.run()
</code></pre><p>hello.html
</p>
<pre><code>$def with (user, form)
$if user == 'anonymous':
    &lt;p&gt;You are not logged in.&lt;/p&gt;
    &lt;p&gt;
      &lt;form name=&quot;test&quot; method=&quot;POST&quot;&gt; 
      $:form.render()
      &lt;input type=&quot;submit&quot; name=&quot;button&quot; value=&quot;Login&quot; /&gt;
      &lt;/form&gt;
    &lt;/p&gt;
    &lt;p&gt;&lt;a href=&quot;./register/&quot;&gt;Register&lt;/a&gt;&lt;/p&gt;
$else:
    &lt;p&gt;You are logged in as: $user&lt;/p&gt;
    &lt;p&gt;&lt;a href=&quot;./logout/&quot;&gt;Logout&lt;/a&gt;&lt;/p&gt;
</code></pre><p>signup.html
</p>
<pre><code>$def with (form)
&lt;form name=&quot;test&quot; method=&quot;POST&quot;&gt; 
$:form.render()
&lt;input type=&quot;submit&quot; value=&quot;Register&quot; /&gt;
&lt;/form&gt;
</code></pre>
<h2>Deployment</h2>
<p>Advantages / disadvantages of different solutions: App Engine, servers...
</p>
<p>TODO: ...
</p>




<div style="clear: both;"></div>

</div>

</div>

        <div id="footer">
    <p>started by <a style="color: gray;" href="http://www.aaronsw.com/">Aaron Swartz</a> (<a style="color: black;" href="mailto:webpy@aaronsw.com">webpy@aaronsw.com</a>)</p>
</div>

</body>
</html>
